<nav class="navbar"
     [class.sidebar-collapsed]="isSidebarCollapsed && !isSidebarHovered"
     [class.mobile-sidebar-open]="isMobile && isSidebarOpen"
     [class.desktop-sidebar-hovered]="!isMobile && isSidebarCollapsed && isSidebarHovered">
  <div class="navbar-content">
    <!-- Left Section -->
    <div class="navbar-left">
      <button class="sidebar-toggle" (click)="onToggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>

      <!-- Breadcrumbs -->
      <nav class="breadcrumbs" aria-label="breadcrumb">
        <ol class="breadcrumb-list">
          <li class="breadcrumb-item">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </li>
          @if (currentPage && currentPage !== 'Dashboard') {
            <li class="breadcrumb-separator">
              <i class="fas fa-chevron-right"></i>
            </li>
            <li class="breadcrumb-item active">
              <span>{{ currentPage }}</span>
            </li>
          }
        </ol>
      </nav>
    </div>

    <!-- Center Section (Search) -->
    <div class="navbar-center">
      <div class="search-container" [class.active]="isSearchActive">
        <div class="search-input-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input
            type="text"
            class="search-input"
            placeholder="Buscar en Malecón Mágico..."
            [(ngModel)]="searchQuery"
            (focus)="onSearchFocus()"
            (blur)="onSearchBlur()"
            (input)="onSearchInput($event)">
          @if (searchQuery) {
            <button class="search-clear" (click)="clearSearch()">
              <i class="fas fa-times"></i>
            </button>
          }
        </div>

        <!-- Search Results Dropdown -->
        @if (isSearchActive && searchResults.length > 0) {
          <div class="search-dropdown">
            <div class="search-results">
              @for (result of searchResults; track result.id) {
                <button class="search-result-item" (click)="navigateToResult(result)">
                  <i [class]="result.icon"></i>
                  <div class="result-content">
                    <span class="result-title">{{ result.title }}</span>
                    <span class="result-description">{{ result.description }}</span>
                  </div>
                </button>
              }
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Right Section -->
    <div class="navbar-right">
      <!-- Mobile Search Toggle -->
      <button
        class="mobile-search-toggle"
        (click)="toggleMobileSearch()"
        title="Buscar">
        <i class="fas fa-search"></i>
      </button>

      <!-- Mobile Menu Toggle -->
      <button
        class="mobile-menu-toggle"
        [class.active]="showMobileActions"
        (click)="toggleMobileActions()"
        title="Menú">
        <div class="hamburger">
          <span></span>
          <span></span>
          <span></span>
          <span></span>
        </div>
      </button>

      <!-- Theme Toggle -->
      <button class="theme-toggle" (click)="toggleTheme()" title="Cambiar tema">
        <i [class]="isDarkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
      </button>

      <!-- Notifications -->
      <div class="notifications-wrapper">
        <button class="notifications-btn" (click)="toggleNotifications($event)" title="Notificaciones">
          <i class="fas fa-bell"></i>
          @if (unreadNotifications > 0) {
            <span class="notification-badge">{{ unreadNotifications }}</span>
          }
        </button>

        @if (showNotifications) {
          <div class="notifications-dropdown">
            <div class="notifications-header">
              <h6>Notificaciones</h6>
              @if (unreadNotifications > 0) {
                <button class="mark-all-read" (click)="markAllAsRead()">
                  Marcar como leídas
                </button>
              }
            </div>
            <div class="notifications-list">
              @for (notification of notifications; track notification.id) {
                <div class="notification-item" [class.unread]="!notification.read">
                  <div class="notification-icon">
                    <i [class]="notification.icon"></i>
                  </div>
                  <div class="notification-content">
                    <p class="notification-text">{{ notification.text }}</p>
                    <span class="notification-time">{{ notification.time }}</span>
                  </div>
                </div>
              } @empty {
                <div class="no-notifications">
                  <i class="fas fa-bell-slash"></i>
                  <p>No hay notificaciones</p>
                </div>
              }
            </div>
          </div>
        }
      </div>

      <!-- User Menu -->
      @if (currentUser) {
        <div class="user-menu" [class.active]="showUserMenu">
          <button class="user-trigger" (click)="toggleUserMenu($event)">
            <div class="user-info">
              <span class="user-name">{{ currentUser.name }}</span>
              <span class="user-role">{{ currentUser.role }}</span>
            </div>
            <div class="user-avatar">
              @if (currentUser.avatar) {
                <img [src]="currentUser.avatar" [alt]="currentUser.name" class="avatar-image">
              } @else {
                <i class="fas fa-user"></i>
              }
            </div>
            <i class="fas fa-chevron-down dropdown-arrow"></i>
          </button>

          @if (showUserMenu) {
            <div class="user-dropdown">
              <div class="user-dropdown-header">
                <div class="user-avatar-large">
                  @if (currentUser.avatar) {
                    <img [src]="currentUser.avatar" [alt]="currentUser.name" class="avatar-image">
                  } @else {
                    <i class="fas fa-user"></i>
                  }
                </div>
                <div class="user-details">
                  <h6>{{ currentUser.name }}</h6>
                  <p>{{ currentUser.email }}</p>
                </div>
              </div>

              <div class="user-menu-items">
                <button class="user-menu-item" (click)="navigateToProfile()">
                  <i class="fas fa-user-circle"></i>
                  <span>Mi Perfil</span>
                </button>
                <button class="user-menu-item" (click)="navigateToSettings()">
                  <i class="fas fa-cog"></i>
                  <span>Configuración</span>
                </button>
                <button class="user-menu-item" (click)="viewActivity()">
                  <i class="fas fa-clock"></i>
                  <span>Actividad Reciente</span>
                </button>
                <div class="menu-divider"></div>
                <button class="user-menu-item logout" (click)="onLogout()">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>Cerrar Sesión</span>
                </button>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</nav>

<!-- Mobile Search Overlay -->
@if (showMobileSearch) {
  <div style="
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    background-color: rgba(0, 0, 0, 0.8) !important;
    z-index: 999999 !important;
    display: flex !important;
    align-items: flex-start !important;
    justify-content: center !important;
    padding: 20px !important;
    box-sizing: border-box !important;
  " (click)="toggleMobileSearch()">
    <div style="
      background: white !important;
      border-radius: 12px !important;
      width: 100% !important;
      max-width: 400px !important;
      margin-top: 60px !important;
      overflow: hidden !important;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3) !important;
    " (click)="$event.stopPropagation()">
      <div style="
        background: var(--primary-color) !important;
        color: white !important;
        padding: 16px !important;
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
      ">
        <h3 style="margin: 0 !important; font-size: 18px !important;">Buscar</h3>
        <button style="
          background: none !important;
          border: none !important;
          color: white !important;
          font-size: 20px !important;
          cursor: pointer !important;
          padding: 4px !important;
          width: 32px !important;
          height: 32px !important;
          border-radius: 50% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        " (click)="toggleMobileSearch()">
          ✕
        </button>
      </div>
      <div style="padding: 20px !important;">
        <div style="display: flex !important; margin-bottom: 20px !important;">
          <input
            #mobileSearchInput
            type="search"
            placeholder="¿Qué estás buscando?"
            [(ngModel)]="searchQuery"
            style="
              flex: 1 !important;
              padding: 12px !important;
              border: 2px solid #e0e0e0 !important;
              border-radius: 8px !important;
              border-top-right-radius: 0 !important;
              border-bottom-right-radius: 0 !important;
              font-size: 16px !important;
              outline: none !important;
            "
            (keyup.enter)="performSearch(mobileSearchInput.value)"
            (input)="onSearchInput($event)"
          />
          <button style="
            background: var(--primary-color) !important;
            color: white !important;
            border: none !important;
            padding: 12px 16px !important;
            border-radius: 8px !important;
            border-top-left-radius: 0 !important;
            border-bottom-left-radius: 0 !important;
            cursor: pointer !important;
          " (click)="performSearch(mobileSearchInput.value)">
            🔍
          </button>
        </div>
        
        @if (searchResults.length > 0) {
          <div style="margin-bottom: 20px !important;">
            <h4 style="margin: 0 0 12px 0 !important; color: #333 !important; font-size: 14px !important;">Resultados</h4>
            @for (result of searchResults; track result.id) {
              <button style="
                width: 100% !important;
                text-align: left !important;
                background: #f8f9fa !important;
                border: 1px solid #e0e0e0 !important;
                border-radius: 8px !important;
                padding: 12px !important;
                margin-bottom: 8px !important;
                cursor: pointer !important;
                display: flex !important;
                align-items: center !important;
                gap: 12px !important;
              " (click)="onSearchResultClick(result)">
                <i [class]="result.icon" style="color: var(--primary-color) !important;"></i>
                <div>
                  <div style="font-weight: 500 !important; color: #333 !important;">{{ result.title }}</div>
                  <div style="font-size: 12px !important; color: #666 !important;">{{ result.description }}</div>
                </div>
              </button>
            }
          </div>
        }
        
        <div>
          <h4 style="margin: 0 0 12px 0 !important; color: #666 !important; font-size: 14px !important;">Búsquedas populares</h4>
          <div style="display: flex !important; flex-wrap: wrap !important; gap: 8px !important;">
            <span style="
              background: #f0f0f0 !important;
              color: #333 !important;
              padding: 6px 12px !important;
              border-radius: 16px !important;
              font-size: 14px !important;
              cursor: pointer !important;
            " (click)="performSearch('restaurantes')">Restaurantes</span>
            <span style="
              background: #f0f0f0 !important;
              color: #333 !important;
              padding: 6px 12px !important;
              border-radius: 16px !important;
              font-size: 14px !important;
              cursor: pointer !important;
            " (click)="performSearch('hoteles')">Hoteles</span>
            <span style="
              background: #f0f0f0 !important;
              color: #333 !important;
              padding: 6px 12px !important;
              border-radius: 16px !important;
              font-size: 14px !important;
              cursor: pointer !important;
            " (click)="performSearch('eventos')">Eventos</span>
            <span style="
              background: #f0f0f0 !important;
              color: #333 !important;
              padding: 6px 12px !important;
              border-radius: 16px !important;
              font-size: 14px !important;
              cursor: pointer !important;
            " (click)="performSearch('actividades')">Actividades</span>
          </div>
        </div>
      </div>
    </div>
  </div>
}

<!-- Mobile Actions Menu -->
<div class="mobile-actions" [class.active]="showMobileActions">
  <div class="mobile-actions-grid">
    <button class="mobile-action-item" (click)="toggleTheme()">
      <i [class]="isDarkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
      <span>{{ isDarkMode ? 'Modo Claro' : 'Modo Oscuro' }}</span>
    </button>

    <button class="mobile-action-item" (click)="toggleNotifications($event)">
      <i class="fas fa-bell"></i>
      <span>Notificaciones</span>
    </button>

    <button class="mobile-action-item" (click)="navigateToProfile()">
      <i class="fas fa-user-circle"></i>
      <span>Mi Perfil</span>
    </button>

    <button class="mobile-action-item" (click)="navigateToSettings()">
      <i class="fas fa-cog"></i>
      <span>Configuración</span>
    </button>

    <button class="mobile-action-item logout" (click)="onLogout()">
      <i class="fas fa-sign-out-alt"></i>
      <span>Cerrar Sesión</span>
    </button>
  </div>
</div>
