<!-- Overlay para m贸viles -->
@if (isMobile && isOpen) {
  <div class="sidebar-overlay show" (click)="onCloseSidebar()"></div>
}

<aside class="sidebar"
       [class.collapsed]="isCollapsed && !isMobile"
       [class.mobile-open]="isMobile && isOpen"
       [class.desktop-hovered]="!isMobile && isCollapsed && isHovered"
       (mouseenter)="onMouseEnter()"
       (mouseleave)="onMouseLeave()">
  <div class="sidebar-content">
    <div class="sidebar-header">
      <div class="logo">
        <img [src]="logoPath"
             alt="Logo"
             class="logo-icon"
             loading="lazy"
             (error)="onImageError($event)">
        @if (shouldShowText()) {
          <span>{{ appName }}</span>
        }
      </div>

      <!-- Bot贸n de cerrar solo en m贸viles -->
      @if (isMobile && isOpen) {
        <button class="close-btn" (click)="onCloseSidebar()">
          <i class="fas fa-times"></i>
        </button>
      }
    </div>

    <nav class="sidebar-nav">
      @for (section of navigationSections; track trackBySection($index, section)) {
        <div class="nav-section">
          @if (section.title) {
            <div class="section-title">{{ section.title }}</div>
          }
          
          <ul class="nav-list">
            @for (item of section.items; track trackByRoute($index, item)) {
              <li class="nav-item">
                <a class="nav-link"
                   [class.active]="isActiveRoute(item.route)"
                   [class.has-submenu]="item.hasSubmenu"
                   (click)="item.hasSubmenu ? onToggleSubmenu(item.id) : onNavigate(item.route)">
                  <i [class]="item.icon"></i>
                  @if (shouldShowText()) {
                    <span class="nav-text">{{ item.label }}</span>
                    @if (item.badge) {
                      <span class="nav-badge" [class]="'badge-' + item.badge.color">{{ item.badge.text }}</span>
                    }
                    @if (item.hasSubmenu) {
                      <i class="fas fa-chevron-down submenu-arrow" 
                         [class.expanded]="isSubmenuExpanded(item.id)"></i>
                    }
                  }
                </a>
                
                @if (item.hasSubmenu && isSubmenuExpanded(item.id) && shouldShowText()) {
                  <ul class="submenu">
                    @for (subItem of item.submenu; track subItem.id) {
                      <li class="submenu-item">
                        <a class="submenu-link"
                           [class.active]="isActiveRoute(subItem.route)"
                           (click)="onNavigate(subItem.route)">
                          <span>{{ subItem.label }}</span>
                        </a>
                      </li>
                    }
                  </ul>
                }
              </li>
            }
          </ul>
        </div>
      }
    </nav>

    <!-- Sidebar Footer con perfil de usuario -->
    <div class="sidebar-footer">
      <div class="user-profile">
        <div class="user-avatar">
          <img [src]="userAvatarPath" 
               alt="User Avatar" 
               class="avatar-image"
               loading="lazy"
               (error)="onUserAvatarError($event)">
        </div>
        
        @if (shouldShowText()) {
          <div class="user-info">
            <div class="user-name">{{ userName }}</div>
            <div class="user-role">{{ userRole }}</div>
          </div>
          
          <button class="logout-btn" 
                  (click)="onLogout()"
                  title="Cerrar Sesi贸n">
            <i class="fas fa-power-off"></i>
          </button>
        }
      </div>
    </div>
  </div>
</aside>
